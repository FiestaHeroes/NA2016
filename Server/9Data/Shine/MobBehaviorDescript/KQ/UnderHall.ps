open [Regen_060_120]
    mobregen Aggressive "KDUnHall" "KDUnderArea1" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea2" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea3" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea4" "Breeder" "EventManagerA".
close

open [Regen_120_180]
    mobregen Aggressive "KDUnHall" "KDUnderArea5" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea6" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea7" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea8" "Breeder" "EventManagerA".
close

open [Regen_180_240]
    mobregen Aggressive "KDUnHall" "KDUnderArea9" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea10" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea11" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea12" "Breeder" "EventManagerA".
close

open [Regen_240_360]
    mobregen Aggressive "KDUnHall" "KDUnderArea13" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea14" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea15" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea16" "Breeder" "EventManagerA".
close

open [Regen_360_480]
    mobregen Aggressive "KDUnHall" "KDUnderArea17" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea18" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea19" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea20" "Breeder" "EventManagerA".
close

open [Regen_480_600]
    mobregen Aggressive "KDUnHall" "KDUnderArea21" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea22" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea23" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea24" "Breeder" "EventManagerA".
close

open [Regen_600_720]
    mobregen Aggressive "KDUnHall" "KDUnderArea25" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea26" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea27" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea28" "Breeder" "EventManagerA".
close

open [Regen_720_840]
    mobregen Aggressive "KDUnHall" "KDUnderArea29" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea30" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea31" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea32" "Breeder" "EventManagerA".
close

open [Regen_840_1040]
    mobregen Aggressive "KDUnHall" "KDUnderArea33" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea34" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea35" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea36" "Breeder" "EventManagerA".
close

open [Regen_1040_1320]
    mobregen Aggressive "KDUnHall" "KDUnderArea37" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea38" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea39" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea40" "Breeder" "EventManagerA".
close

open [Regen_1320_1350]
    mobregen Aggressive "KDUnHall" "KDUnderArea41" "Breeder" "EventManagerA".
close

open [Regen_1350_1360]
    mobregen Aggressive "KDUnHall" "KDUnderArea42" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea43" "Breeder" "EventManagerA".
close

open [Regen_1360_1370]
    mobregen Aggressive "KDUnHall" "KDUnderArea44" "Breeder" "EventManagerA".
close

open [Regen_1370_1380]
    mobregen Aggressive "KDUnHall" "KDUnderArea45" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea46" "Breeder" "EventManagerA".
close

open [Regen_1380_1390]
    mobregen Aggressive "KDUnHall" "KDUnderArea47" "Breeder" "EventManagerA".
close

open [Regen_1390_1400]
    mobregen Aggressive "KDUnHall" "KDUnderArea48" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea49" "Breeder" "EventManagerA".
close

open [Regen_1400_1410]
    mobregen Aggressive "KDUnHall" "KDUnderArea50" "Breeder" "EventManagerA".
    mobregen Aggressive "KDUnHall" "KDUnderArea51" "Breeder" "EventManagerA".
close

open [Regen_1410_1440]
    mobregen Aggressive "KDUnHall" "KDUnderArea52" "Breeder" "EventManagerA".
close

open [Regen_1440_1800]
    mobregen Aggressive "KDUnHall" "KDUnderArea53" "Breeder" "EventManagerA".
close
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
open [main]
    var MyName.
    var MyHandle.
    myname MyName.
    myhandle MyHandle.

    call MyName "DefRoutine".
close

open [DefRoutine]
close

open [WaitPlayerEntry]
    var InitRest.
    var CurRest.
    kqrestminute InitRest.                ; 남은 시간을 분단위로 얻어옴

    var Ply.
    Ply = 0.
    while Ply == 0
    open
        howmanymob Ply "Player".           ; 들어온 플레이어들 확인

        kqrestminute CurRest.                ; 남은 시간을 분단위로 얻어옴
        if InitRest - CurRest > 5               ; 5분간 대기
        then
        open
            print "Room vanish".
            endofevent KingdomQuest 0.       ; 킹덤퀘스트 실패로 마무리
            break "main".
        close
    close
close

open [IsTimeUp]            ; 시간제한이 다 되었는지 확인
    print "IsTimeUp".
    var TimeUp.
    kqrestminute TimeUp.                ; 남은 시간을 분단위로 얻어옴
    print "EventManagerAIsTimeUp : " % TimeUp % "Minute left".
    if TimeUp == 0                      ; 시간오버
    then
    open
        print "IsTimeUp : Exit 0".
        KQResult = "Success".
        break "MainLoop".
    close

    var Ply.
    howmanymob Ply "Player".           ; 남아있는 플레이어들 확인
    print "EventManagerAIsTimeUp : " % Ply % "Player left".
    if Ply == 0
    then
    open
        print "IsTimeUp : Exit 1".
        KQResult = "Fail".
        break "MainLoop".
    close
close
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
open [EventManagerA]

    print "EventManagerA : Entry".

    call "WaitPlayerEntry".             ; 사람들이 들어올 때까지 기다림

    wait sec 5.     ;   5
    shout all "천년로보" "마나의 흐름을 마음대로 바꾸어 자연법칙을 파괴하는 다크엘프들".

    wait sec 5.     ;  10
    shout all "천년로보" "평화롭게 살고 있는 동식물을 학살하는 인간들".

    wait sec 5.     ;  15
    shout all "천년로보" "그리고 그런 인간들에게 빌붙어 자연을 잃어버린 엘프들".

    wait sec 5.     ;  20
    shout all "천년로보" "드디어 오늘 너희들에게 자연의 보복이 얼마나 무서운지를".

    wait sec 5.     ;  25
    shout all "파이어비비" "모두 죽이자!!".
    shout all "천년로보" "모두 죽...".

    wait sec 5.     ;  30
    shout all "파이어비비" "킥!!".

    wait sec 5.     ;  35
    shout all "천년로보" "얼마나 무서운지를 똑똑히 보여주리라".

    wait sec 5.     ;  40
    shout all "천년로보" "인간과 엘프, 다크엘프들에게 학대받아온 자연의..".

    wait sec 5.     ;  45
    shout all "와일드깨빙" "인간들아, 각오해라!".
    shout all "천년로보" "인간들아...".

    wait sec 5.     ;  50
    shout all "천년로보" "끼어들지 말란 말야!".
    shout all "와일드깨빙" "켁!!".

    wait sec 5.     ;  55
    shout all "천년로보" "흠.. 어쨋든 자연의 피조물들이여, 진격하라!".

    call "Regen_060_120".
    wait sec 120 - 60.

    call "Regen_120_180".
    wait sec 180 - 120.

    call "Regen_180_240".
    wait sec 240 - 180.

    call "Regen_240_360".
    wait sec 360 - 240.

    call "Regen_360_480".
    wait sec 480 - 360.

    call "Regen_480_600".
    wait sec 600 - 480.

    call "Regen_600_720".
    wait sec 720 - 600.

    call "Regen_720_840".
    wait sec 840 - 720.

    call "Regen_840_1040".
    wait sec 1040 - 840.

    call "Regen_1040_1320".
    wait sec 1320 - 1040.

    call "Regen_1320_1350".
    wait sec 1350 - 1320.

    call "Regen_1350_1360".
    wait sec 1360 - 1350.

    call "Regen_1360_1370".
    wait sec 1370 - 1360.

    call "Regen_1370_1380".
    wait sec 1380 - 1370.

    call "Regen_1380_1390".
    wait sec 1390 - 1380.

    call "Regen_1390_1400".
    wait sec 1400 - 1390.

    call "Regen_1400_1410".
    wait sec 1410 - 1400.

    call "Regen_1410_1440".
    wait sec 1440 - 1410.

    call "Regen_1440_1800".

    var KQResult.   ; IsTimeUp에서 사용할 변수
    
    open [MainLoop]
        infinite
        open
            call "IsTimeUp".
        close
    close

    if KQResult === "Success"
    then
    open
        reward KingdomQuest.         ; 리워드를 줌
        broadcast all "천년로보의 방어에 성공하였습니다.".
        endofevent KingdomQuest 1.  ; 킹덤퀘스트 성공으로 마무리
    close
    else
    open
        broadcast all "천년로보의 방어에 실패하였습니다.".
        endofevent KingdomQuest 0.       ; 킹덤퀘스트 실패로 마무리
    close

    broadcast all "30초후 루멘으로 이동합니다.".
    wait sec 10.
    broadcast all "20초후 루멘으로 이동합니다.".
    wait sec 10.
    broadcast all "10초후 루멘으로 이동합니다.".
    wait sec 5.
    broadcast all "5초후 루멘으로 이동합니다.".
    wait sec 5.
    linkto all "Rou" "Rou" 7907 8572.

    mapclear all.

close
