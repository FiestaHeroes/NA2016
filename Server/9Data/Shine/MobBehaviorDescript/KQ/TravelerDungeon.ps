open [Regen_1]
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea01" "Breeder" "EventManagerA".
close

open [Regen_2]
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea02" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea03" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea04" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea05" "Breeder" "EventManagerA".
close

open [Regen_3]
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea06" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea07" "Breeder" "EventManagerA".
close

open [Regen_4]
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea10" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea11" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea12" "Breeder" "EventManagerA".
close

open [Regen_5]
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea13" "Breeder" "EventManagerA".
close

open [Regen_6]
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea14" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea16" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea17" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea19" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea20" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea21" "Breeder" "EventManagerA".
close

open [Regen_7]
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea24" "Breeder" "EventManagerA".
close

open [Regen_8]
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea25" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea26" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea27" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea28" "Breeder" "EventManagerA".
close

open [Regen_9]
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea29" "Breeder" "EventManagerA".
close

open [Regen_10]
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea30" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea31" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea32" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea33" "Breeder" "EventManagerA".
close

open [Regen_11]
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea34" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea35" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea36" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea37" "Breeder" "EventManagerA".
close

open [Regen_12]
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea39" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea40" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea41" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea42" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea43" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea44" "Breeder" "EventManagerA".
close

open [Regen_13]
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea45" "Breeder" "EventManagerA".
close

open [Regen_14]
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea47" "Breeder" "EventManagerA".
close

open [Regen_15]
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea49" "Breeder" "EventManagerA".
close

open [Regen_16]
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea51" "Breeder" "EventManagerA".
close

open [Regen_17]
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea53" "Breeder" "EventManagerA".
close

open [Regen_18]
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea54" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea55" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea56" "Breeder" "EventManagerA".
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea57" "Breeder" "EventManagerA".
close

open [Regen_19]
    mobregen Aggressive "KDTrDn" "KDTravelerDnArea58" "Breeder" "EventManagerA".
close
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
open [main]
    var MyName.
    var MyHandle.
    myname MyName.
    myhandle MyHandle.

    call MyName "DefRoutine".
close

open [DefRoutine]
close

open [WaitPlayerEntry]
    var InitRest.
    var CurRest.
    kqrestminute InitRest.                ; 남은 시간을 분단위로 얻어옴

    var Ply.
    Ply = 0.
    while Ply == 0
    open
        howmanymob Ply "Player".           ; 들어온 플레이어들 확인

        kqrestminute CurRest.                ; 남은 시간을 분단위로 얻어옴
        if InitRest - CurRest > 5               ; 5분간 대기
        then
        open
            print "Room vanish".
            endofevent KingdomQuest 0.       ; 킹덤퀘스트 실패로 마무리
            break "main".
        close
    close
close

open [IsTimeUp]            ; 시간제한이 다 되었는지 확인
    print "IsTimeUp".
    var TimeUp.
    kqrestminute TimeUp.                ; 남은 시간을 분단위로 얻어옴
    print "EventManagerAIsTimeUp : " % TimeUp % "Minute left".
    if TimeUp == 0                      ; 시간오버
    then
    open
        print "IsTimeUp : Exit 0".
        KQResult = "Fail".
        break "MainLoop".
    close

    var Ply.
    howmanymob Ply "Player".           ; 남아있는 플레이어들 확인
    print "EventManagerAIsTimeUp : " % Ply % "Player left".
    if Ply == 0
    then
    open
        print "IsTimeUp : Exit 1".
        KQResult = "Fail".
        break "MainLoop".
    close
close

open [WaitMobRegen]
    var Mob.
    Mob = 0.
    while Mob == 0
    open
        howmanymob Mob "All".                ; 모든 적수 확인
    close
close

open [WaitMobAnnihilation]
    var Mob.
    Mob = 10.
    while Mob > 0
    open
        howmanymob Mob "All".                ; 모든 적수 확인
        call "IsTimeUp".
    close

    broadcast all "모든 적을 다 물리치셨군요.".
close
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
open [EventManagerA]

    print "EventManagerA : Entry".

    call "WaitPlayerEntry".             ; 사람들이 들어올 때까지 기다림

    var Stage.
    Stage = 1.

    var KQResult.
    KQResult = "Success".

    broadcast all "자, 이제부터 여러가지 적들이".
    broadcast all "여러분들의 앞을 막아설 것입니다.".
    broadcast all "모두들 행운을 빕니다.".

    open [MainLoop]
        while Stage <= 19
        open
            broadcast all "다음 적이 나타날 때까지 잠시만 기다려 주십시오.".

            var RegenRoutine.
            RegenRoutine = "Regen_" % Stage.

            call RegenRoutine.          ; 적 리젠
            call "WaitMobRegen".         ; 리젠될때까지 기다림
            call "WaitMobAnnihilation".   ; 전멸할때까지 기다림

            Stage = Stage + 1.
        close
    close

    if KQResult === "Success"
    then
    open
        reward KingdomQuest.         ; 리워드를 줌
        broadcast all "모든 적을 물리치고 여행자던전을 통과하셨습니다.".
        endofevent KingdomQuest 1.  ; 킹덤퀘스트 성공으로 마무리
    close
    else
    open
        broadcast all "여행자던전을 통과하지 못하셨습니다.".
        endofevent KingdomQuest 0.       ; 킹덤퀘스트 실패로 마무리
    close

    broadcast all "30초후 루멘으로 이동합니다.".
    wait sec 10.
    broadcast all "20초후 루멘으로 이동합니다.".
    wait sec 10.
    broadcast all "10초후 루멘으로 이동합니다.".
    wait sec 5.
    broadcast all "5초후 루멘으로 이동합니다.".
    wait sec 5.
    linkto all "Rou" "Rou" 7907 8572.

    mapclear all.

close
