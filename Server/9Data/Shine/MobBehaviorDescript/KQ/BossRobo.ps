open [RegenBossRobo]
    mobregen Aggressive "KDRockCan" "KDRockCanArea36" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea83" "Breeder" "EventManagerA".
close

open [RegenDesertWolf]
    mobregen Aggressive "KDRockCan" "KDRockCanArea11" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea28" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea103" "Breeder" "EventManagerA".
close

open [RegenGiantMushroom]
    mobregen Aggressive "KDRockCan" "KDRockCanArea03" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea04" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea06" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea09" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea14" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea20" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea21" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea29" "Breeder" "EventManagerA".
close

open [RegenKissLips]
    mobregen Aggressive "KDRockCan" "KDRockCanArea73" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea78" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea85" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea87" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea93" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea97" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea101" "Breeder" "EventManagerA".
close

open [RegenRapidBoar]
    mobregen Aggressive "KDRockCan" "KDRockCanArea12" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea27" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea31" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea34" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea39" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea40" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea41" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea43" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea61" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea62" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea63" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea64" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea68" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea72" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea86" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea90" "Breeder" "EventManagerA".
close

open [RegenSandRatman]
    mobregen Aggressive "KDRockCan" "KDRockCanArea01" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea32" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea33" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea35" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea47" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea51" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea53" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea81" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea92" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea95" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea98" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea99" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea100" "Breeder" "EventManagerA".
close

open [RegenSmallProck]
    mobregen Aggressive "KDRockCan" "KDRockCanArea02" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea13" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea19" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea44" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea48" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea49" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea54" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea55" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea56" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea57" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea58" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea59" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea60" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea66" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea67" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea70" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea71" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea74" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea75" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea76" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea77" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea79" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea80" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea82" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea84" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea88" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea89" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea94" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea96" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea102" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea104" "Breeder" "EventManagerA".
close

open [RegenStoneImp]
    mobregen Aggressive "KDRockCan" "KDRockCanArea08" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea10" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea15" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea16" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea17" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea18" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea22" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea24" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea30" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea50" "Breeder" "EventManagerA".
close

open [RegenWildKebing]
    mobregen Aggressive "KDRockCan" "KDRockCanArea05" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea07" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea23" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea25" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea26" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea37" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea38" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea42" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea45" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea46" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea52" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea65" "Breeder" "EventManagerA".
    mobregen Aggressive "KDRockCan" "KDRockCanArea91" "Breeder" "EventManagerA".
close
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
open [main]
    var MyName.
    var MyHandle.
    myname MyName.
    myhandle MyHandle.

    var KQResult.

    call MyName "DefRoutine".
close

open [DefRoutine]
close

open [WaitPlayerEntry]
    var InitRest.
    var CurRest.
    kqrestminute InitRest.                ; 남은 시간을 분단위로 얻어옴

    var Ply.
    Ply = 0.
    while Ply == 0
    open
        howmanymob Ply "Player".           ; 들어온 플레이어들 확인

        kqrestminute CurRest.                ; 남은 시간을 분단위로 얻어옴
        if InitRest - CurRest > 5       ; 5분간 대기
        then
        open
            print "Room vanish".
            endofevent KingdomQuest 0.       ; 킹덤퀘스트 실패로 마무리
            break "main".
        close
    close
close

open [IsTimeUp]            ; 시간제한이 다 되었는지 확인
    print "IsTimeUp".
    var TimeUp.
    kqrestminute TimeUp.                ; 남은 시간을 분단위로 얻어옴
    print "EventManagerAIsTimeUp : " % TimeUp % "Minute left".
    if TimeUp == 0                      ; 시간오버
    then
    open
        print "IsTimeUp : Exit 0".
        KQResult = "Success".
        break "MainLoop".
    close


    var Ply.
    howmanymob Ply "Player".           ; 남아있는 플레이어들 확인
    print "EventManagerAIsTimeUp : " % Ply % "Player left".
    if Ply == 0
    then
    open
        print "IsTimeUp : Exit 1".
        KQResult = "Fail".
        break "MainLoop".
    close



    ; 로보체크
    var Robo.
    howmanymob Robo "KQ_BossRobo".           ; 남아있는 플레이어들 확인
    print "EventManagerAIsTimeUp : " % Ply % "Robo left".
    if Robo == 0
    then
    open
        print "IsTimeUp : Exit 2".
        KQResult = "Success".
        break "MainLoop".
    close
close
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
open [EventManagerAMobAppend]
    var Mobs.
    howmanymob Mobs "KQ_" % AppendMobName.
    if Mobs < 10
    then
    open
        call "Regen" % AppendMobName.
    close
close

open [EventManagerA]

    print "EventManagerA : Entry".

    var CurMap.
    currentmap CurMap.                  ; 현재 주인몹이 있는 맵 리턴

    ; 플레이어가 들어오기를 기다림
    call "WaitPlayerEntry".

    var LeftMinute.
    var AppendMobName.


    AppendMobName = "StoneImp".         call "EventManagerAMobAppend".
    AppendMobName = "DesertWolf".       call "EventManagerAMobAppend".
    AppendMobName = "GiantMushroom".    call "EventManagerAMobAppend".
    AppendMobName = "KissLips".         call "EventManagerAMobAppend".
    AppendMobName = "RapidBoar".        call "EventManagerAMobAppend".
    AppendMobName = "SandRatman".       call "EventManagerAMobAppend".
    AppendMobName = "SmallProck".       call "EventManagerAMobAppend".
    AppendMobName = "WildKebing".       call "EventManagerAMobAppend".
    AppendMobName = "BossRobo".         call "EventManagerAMobAppend".




    open [MainLoop]
        infinite
        open


;           예전 서버이벌 버전
;            kqrestminute LeftMinute.                ; 남은 시간을 분단위로 얻어옴
;
;            AppendMobName = "StoneImp".         call "EventManagerAMobAppend".
;            AppendMobName = "DesertWolf".       call "EventManagerAMobAppend".
;            if LeftMinute < 25
;            then
;            open
;                AppendMobName = "GiantMushroom".    call "EventManagerAMobAppend".
;                AppendMobName = "KissLips".         call "EventManagerAMobAppend".
;            close
;            if LeftMinute < 20
;            then
;            open
;                AppendMobName = "RapidBoar".        call "EventManagerAMobAppend".
;                AppendMobName = "SandRatman".       call "EventManagerAMobAppend".
;            close
;            if LeftMinute < 15
;            then
;            open
;                AppendMobName = "SmallProck".       call "EventManagerAMobAppend".
;                AppendMobName = "WildKebing".       call "EventManagerAMobAppend".
;            close
;            if LeftMinute < 5
;            then
;            open
;                AppendMobName = "BossRobo".         call "EventManagerAMobAppend".
;            close

            call "IsTimeUp".
        close
    close

    wait sec 3.
    if KQResult === "Success"   ; 성공
    then
    open
        reward KingdomQuest.         ; 리워드를 줌
        broadcast all "천년로보를 처치하는데 성공했습니다.".
        endofevent KingdomQuest 1.  ; 킹덤퀘스트 성공으로 마무리
    close
    else
    open
        broadcast all "천년로보를 처치하는데 실패했습니다.".
        endofevent KingdomQuest 0.       ; 킹덤퀘스트 실패로 마무리
    close

    broadcast all "30초후 루멘으로 이동합니다.".
    wait sec 10.
    broadcast all "20초후 루멘으로 이동합니다.".
    wait sec 10.
    broadcast all "10초후 루멘으로 이동합니다.".
    wait sec 5.
    broadcast all "5초후 루멘으로 이동합니다.".
    wait sec 5.
    linkto all "Rou" "Rou" 7907 8572.
 
    retrate me.


close

;open [KQ_BossRobo]
;    shout all "" "바보같은 놈들! 언제까지 이따위 쓰레기들과 놀고 있을 셈이냐!".
;    wait sec 2.
;    shout all "" "인간같은 날파리들에게 쩔쩔매다니, 한심한 것들!".
;    wait sec 2.
;    shout all "" "자연을 파괴하는 쓰레기들은 내가 직접 응징하리라!".
;
;    open [MainLoop]
;        infinite
;        open
;            call "IsTimeUp".
;        close
;    close
;    
;    if KQResult === "Success"   ; 성공
;    then
;    open
;        shout "" all "이럴수가... 천년의 준비가 물거품이 되어버리다니...".
;        wait sec 2.
;        shout "" all "하지만... 다른 천년로보가 너희들을 단죄할 것이다.".
;    close
;close
